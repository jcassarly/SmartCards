@startuml

title Conditional - Activity Diagram 

start

if (Pi Has Existing Decklist?) then (no)
  :Wait for Bluetooth Connection Established;
  while (Decklist received?) is (no)
    :Request Decklist;
  endwhile (yes)
  else (yes)
endif

:Load Decklist in;

:Spawn Bluetooth and Flashing processes;
note left: Bluetooth process in separate diagram

:__Flashing__;
repeat
:Wait for display insertion;
note left: Id goes from 0 to !0
:Acquire lock on deck;
if (Deck empty?) then (no)
    :Move card on display to "Discard";
    :Move next card in deck to "In Play";
    :Flash new "In Play" card and blink status;
    :Wait for display to finish refreshing;
    :Set "Deck Changed" flag;
else (yes)
    :Indicate EMPTY status;
endif
:Stop blinking and turn on DONE LED;
repeat while (release lock on deck)

@enduml